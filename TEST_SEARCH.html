<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #results {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .result-item {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-left: 3px solid #007bff;
        }
    </style>
</head>
<body>
    <h1>üîç Search Engine Test</h1>
    
    <div class="test-section" id="testDataStatus">
        <h3>1. Testing testData Loading...</h3>
        <p id="testDataResult">Checking...</p>
    </div>
    
    <div class="test-section" id="searchEngineStatus">
        <h3>2. Testing Search Engine...</h3>
        <p id="searchEngineResult">Checking...</p>
    </div>
    
    <div class="test-section">
        <h3>3. Try a Search</h3>
        <input type="text" id="searchInput" placeholder="Type a search query (e.g., VOR, altitude, navigation)">
        <button onclick="performSearch()">Search</button>
        <div id="results"></div>
    </div>

    <!-- LAST403 DATASET MODE -->
    <script src="src/data/last403_explanations_import.js"></script>
    <script src="src/scripts/build_from_last403_only.js"></script>
    <script src="src/scripts/searchIndex.js"></script>
    
    <script>
        // Test 1: Check if testData is loaded
        function checkTestData() {
            const statusDiv = document.getElementById('testDataStatus');
            const resultP = document.getElementById('testDataResult');
            
            if (typeof window.testData === 'undefined') {
                statusDiv.className = 'test-section error';
                resultP.innerHTML = '‚ùå <strong>ERROR:</strong> testData is not loaded (window.testData is undefined)';
                return false;
            }
            
            const categories = Object.keys(window.testData);
            let totalQuestions = 0;
            categories.forEach(cat => {
                window.testData[cat].tests.forEach(test => {
                    totalQuestions += test.questions.length;
                });
            });
            
            statusDiv.className = 'test-section success';
            resultP.innerHTML = `‚úÖ <strong>SUCCESS:</strong> testData loaded with ${categories.length} categories and ${totalQuestions} questions`;
            return true;
        }
        
        // Test 2: Check if SearchEngine is available
        let searchEngine = null;
        function checkSearchEngine() {
            const statusDiv = document.getElementById('searchEngineStatus');
            const resultP = document.getElementById('searchEngineResult');
            
            if (typeof window.SearchEngine === 'undefined') {
                statusDiv.className = 'test-section error';
                resultP.innerHTML = '‚ùå <strong>ERROR:</strong> SearchEngine is not loaded';
                return false;
            }
            
            try {
                searchEngine = new window.SearchEngine(window.testData);
                const docCount = searchEngine.docs.length;
                const tokenCount = searchEngine.inverted.size;
                
                statusDiv.className = 'test-section success';
                resultP.innerHTML = `‚úÖ <strong>SUCCESS:</strong> SearchEngine initialized with ${docCount} documents and ${tokenCount} unique tokens`;
                return true;
            } catch (error) {
                statusDiv.className = 'test-section error';
                resultP.innerHTML = `‚ùå <strong>ERROR:</strong> Failed to initialize SearchEngine: ${error.message}`;
                return false;
            }
        }
        
        // Perform search
        function performSearch() {
            const input = document.getElementById('searchInput');
            const resultsDiv = document.getElementById('results');
            const query = input.value.trim();
            
            if (!query) {
                resultsDiv.innerHTML = '<p style="color: #999;">Please enter a search query</p>';
                return;
            }
            
            if (!searchEngine) {
                resultsDiv.innerHTML = '<p style="color: red;">Search engine not initialized</p>';
                return;
            }
            
            try {
                const results = searchEngine.search(query, 'all', 10);
                
                if (results.length === 0) {
                    resultsDiv.innerHTML = `<p style="color: #999;">No results found for "${query}"</p>`;
                    return;
                }
                
                let html = `<h4>Found ${results.length} results for "${query}":</h4>`;
                results.forEach((result, index) => {
                    const q = result.doc.question.question;
                    const cat = result.doc.categoryName;
                    const score = result.score.toFixed(2);
                    html += `
                        <div class="result-item">
                            <strong>#${index + 1}</strong> (Score: ${score}) - ${cat}<br>
                            ${q.substring(0, 150)}${q.length > 150 ? '...' : ''}
                        </div>
                    `;
                });
                resultsDiv.innerHTML = html;
            } catch (error) {
                resultsDiv.innerHTML = `<p style="color: red;">Search error: ${error.message}</p>`;
                console.error('Search error:', error);
            }
        }
        
        // Run tests on load
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                checkTestData();
                checkSearchEngine();
            }, 100);
        });
        
        // Allow search on Enter key
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
    </script>
</body>
</html>
